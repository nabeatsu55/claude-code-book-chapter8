# プロダクト要求定義書 (Product Requirements Document)

## プロダクト概要

### 名称
**TaskCLI** - Gitと一体化したタスク管理CLIツール

### プロダクトコンセプト
- **ターミナル完結のタスク管理**: GUIツールへの画面切り替えをゼロにし、開発者がターミナルから離れずにタスク管理を完結できる
- **Gitとの深い統合**: タスクとブランチを1対1で自動連携し、コミット・PR・マージとタスクステータスを自動同期
- **開発フローへの自然な溶け込み**: タスク開始→ブランチ作成→コミット→PR→マージ→完了という一連の流れを自動化・支援

### プロダクトビジョン
開発者がターミナルから一切離れることなく、効率的にタスクを管理できるCLIツールを提供する。
Gitとの深い統合により、タスク管理と実際のコーディング作業を完全に一体化させる。
JiraやAsanaのような複雑なツールではなく、開発者が本当に必要とするシンプルで高速な機能だけを提供する。
コンテキストスイッチを最小化し、開発者が本質的なコーディング作業に集中できる環境を実現する。

### 目的
- **コンテキストスイッチの削減**: ターミナル↔GUIブラウザの切り替えを1日20回以上行っている開発者の集中力低下を解消
- **タスクとコードの一体化**: タスク番号のコミット忘れ、完了タスクとPRの紐付け漏れを防ぎ、開発履歴の追跡可能性を向上
- **手作業の自動化**: タスク完了→ステータス更新→PR作成→タスククローズという手作業を自動化し、1日平均30分の時間節約を実現
- **チーム状況の可視化**: CLIからチームメンバーのタスク状況を即座に確認でき、ペアプロや朝会での情報共有を効率化

## ターゲットユーザー

### プライマリーペルソナ: 田中太郎(28歳、フリーランスフルスタックエンジニア)
- **職業・経験**: 開発歴6年、フリーランスとして3-5個のプロジェクトを並行して担当
- **技術スタック**: Node.js/TypeScript、React、Git/GitHub、ターミナル(zsh)、Vim
- **現在の課題**:
  - 複数プロジェクトのタスクが頭の中だけで管理されており、「次何やるんだっけ？」となることが週3回以上
  - GitHub Issuesは使っているが、ローカルの作業と連携できておらず、Issue番号をコミットに書き忘れることが多い
  - Trelloなどを開くのが面倒で、結局メモ帳やTODOコメントでタスク管理している
- **期待する解決策**:
  - ターミナルで完結し、Gitブランチと自動連携してくれる軽量なタスク管理ツール
  - コマンド1つでタスク確認・開始・完了ができる
  - GitHub Issuesとも同期できるが、オフラインでも動作する
- **1日の典型的なワークフロー**:
  - 8:00 ターミナル起動、各プロジェクトのgit statusを確認
  - 8:30-12:00 コーディング(1-2時間ごとにタスク切り替え)
  - 13:00-17:00 コーディング、PR作成、レビュー対応
  - 17:00-18:00 次の日のタスク整理、GitHub Issuesの確認

### セカンダリーペルソナ: 佐藤花子(35歳、スタートアップのテックリード)
- **職業・経験**: 開発歴12年、3人のエンジニアチームをリード
- **技術スタック**: Python/Django、PostgreSQL、Docker、Git/GitHub、ターミナル(bash)
- **現在の課題**:
  - 朝会でチームメンバーのタスク状況確認に10分以上かかる
  - JiraやAsanaは小さいチームには大げさで、導入・運用コストが高い
  - 各メンバーが今何をやっているかリアルタイムで把握したいが、Slackで聞くのも煩雑
- **期待する解決策**:
  - CLIで`task list --team`のように、チーム全体の状況をサッと確認できる
  - GitHub連携で自動的にタスク進捗が更新される
  - 軽量で導入が簡単、チームメンバー全員がすぐに使い始められる
- **1日の典型的なワークフロー**:
  - 9:00 朝会、チームのタスク状況確認
  - 9:30-12:00 自分のコーディング作業
  - 13:00-15:00 コードレビュー、技術相談対応
  - 15:00-18:00 コーディング、設計レビュー

## 成功指標(KPI)

### プライマリーKPI
- **アクティブユーザー数**: リリース後3ヶ月でDAU 100人、MAU 300人
  - 測定方法: オプトインの匿名利用統計(task initで許可を求める)
- **継続率**: 1ヶ月後も使い続けているユーザーが60%以上
  - 測定方法: 初回利用から30日後のアクティビティ
- **タスク完了率**: ユーザーあたり週平均5タスク以上完了
  - 測定方法: 匿名利用統計のタスク完了イベント

### セカンダリーKPI
- **導入率**: 開発者10人に紹介して3人以上が1週間継続使用
  - 測定方法: β版テスター経由の紹介リンクトラッキング
- **タスク管理時間の削減**: ユーザーアンケートで「タスク管理時間が半分以下になった」と回答する人が50%以上
  - 測定方法: リリース後1ヶ月時点でのユーザーアンケート(n≥50)
- **GitHub Stars**: リリース後6ヶ月で500スター
  - 測定方法: GitHubリポジトリのスター数
- **Net Promoter Score (NPS)**: 30以上
  - 測定方法: リリース後2ヶ月時点でのNPSアンケート(n≥30)

## 機能要件

### コア機能(MVP)

#### 1. タスクの基本CRUD操作

**ユーザーストーリー**:
開発者として、ターミナルから離れずにタスクを作成・確認・更新・削除したい。なぜなら、GUIツールへの画面切り替えで集中力が途切れるから。

**受け入れ条件**:
- [ ] `task add "タイトル"` でタスクを作成できる(実行時間100ms以内)
- [ ] `task add "タイトル" --priority high --due 2025-01-20` のようにオプションで優先度と期限を指定できる
- [ ] `task list` で全タスク一覧を表形式(ID, Status, Title, Branch)で表示できる
- [ ] `task show <id>` でタスクの詳細(タイトル、説明、ステータス、優先度、期限、作成日時、更新日時、ブランチ名)を表示できる
- [ ] `task done <id>` でタスクを完了状態(completed)に変更できる
- [ ] `task delete <id>` でタスクを削除できる(確認プロンプト表示)
- [ ] タスクデータは `.task/tasks.json` にJSON形式で保存される
- [ ] タスクIDはUUID v4形式で自動生成される
- [ ] IDは一意性が保証され、分散環境でも衝突しない

**優先度**: P0(必須)

#### 2. タスクステータス管理

**ユーザーストーリー**:
開発者として、タスクの進捗状態を明確に管理したい。なぜなら、今何をやっているか、何が残っているかを常に把握する必要があるから。

**受け入れ条件**:
- [ ] タスクは以下の4つのステータスを持つ: `open`(新規), `in_progress`(作業中), `completed`(完了), `archived`(アーカイブ)
- [ ] タスク作成時のデフォルトステータスは`open`
- [ ] `task start <id>` でタスクを`in_progress`に変更できる
- [ ] `task done <id>` でタスクを`completed`に変更できる
- [ ] `task archive <id>` でタスクを`archived`に変更できる
- [ ] `task list --status <status>` で特定ステータスのタスクのみ絞り込み表示できる
- [ ] `task list` のデフォルト表示では`archived`は除外される

**優先度**: P0(必須)

#### 3. Gitブランチとの自動連携

**ユーザーストーリー**:
開発者として、タスク開始時に自動的にGitブランチを作成・切り替えてほしい。なぜなら、ブランチ名を考えたり、手動でgit checkoutするのが面倒だし、タスクとブランチの紐付けを忘れるから。

**受け入れ条件**:
- [ ] `task start <id>` 実行時、`feature/task-<id>-<slug>` 形式のブランチが自動作成される
  - id: タスクIDの先頭8文字
  - slug: タイトルの小文字英数字ハイフン区切り、最大30文字
  - 例: タスクID `7a5c6ff0-5f55-474e-baf7-ea13624d73a4`、タイトル「ユーザー認証機能の実装」→ ブランチ名 `feature/task-7a5c6ff0-user-authentication`
- [ ] ブランチ作成後、自動的にそのブランチに切り替わる
- [ ] 既にブランチが存在する場合はエラーを出さず、そのブランチに切り替える
- [ ] タスクデータにブランチ名が保存される
- [ ] `task list` でタスクに紐づくブランチ名が表示される
- [ ] Gitリポジトリが存在しない場合は警告を表示し、ブランチ作成をスキップする
- [ ] タスク開始時、未コミットの変更がある場合は警告を表示し、継続するか確認する

**優先度**: P0(必須)

#### 4. タスク一覧のフィルタリングと表示

**ユーザーストーリー**:
開発者として、タスク一覧を条件で絞り込んで表示したい。なぜなら、大量のタスクから必要な情報だけを素早く見つけたいから。

**受け入れ条件**:
- [ ] `task list` でデフォルトは全ステータス(archived除く)を表示
- [ ] `task list --status <status>` で特定ステータスのタスクのみ表示
- [ ] `task list --priority <priority>` で特定優先度のタスクのみ表示
- [ ] 一覧は表形式で見やすく整形される(列: ID, Status, Priority, Title, Branch)
- [ ] ステータスは色分けされる(open=白, in_progress=黄, completed=緑, archived=灰)
- [ ] タスクが0件の場合は「No tasks found」と表示される

**優先度**: P0(必須)

#### 5. データの永続化とエラーハンドリング

**ユーザーストーリー**:
開発者として、作成したタスクデータが確実に保存され、エラーが起きても復旧できるようにしたい。なぜなら、タスクデータの消失は致命的だから。

**受け入れ条件**:
- [ ] タスクデータは `.task/tasks.json` に保存される
- [ ] JSON書き込み前にバックアップファイル `.task/tasks.json.backup` を作成する
- [ ] JSONパースエラー時は、バックアップから復旧を試みる
- [ ] `.task/` ディレクトリが存在しない場合は自動作成する
- [ ] ファイル書き込みエラー時は明確なエラーメッセージを表示する
- [ ] データファイルが破損している場合は、バックアップからの復旧方法を提示する

**優先度**: P0(必須)

### 将来的な機能(Post-MVP)

#### 6. GitHub Issuesとの双方向同期

**ユーザーストーリー**:
開発者として、ローカルのタスクとGitHub Issuesを同期したい。なぜなら、チームメンバーとタスク情報を共有する必要があるから。

**受け入れ条件**:
- [ ] `task sync` でローカルタスクとGitHub Issuesを双方向同期
- [ ] `task import --github` でGitHub Issuesをインポート
- [ ] GitHub Personal Access Tokenで認証
- [ ] タスクとIssueの紐付け情報を保持

**優先度**: P1(重要)

#### 7. タスク検索機能

**ユーザーストーリー**:
開発者として、タスクのタイトルや説明から検索したい。

**受け入れ条件**:
- [ ] `task search <keyword>` でタイトル・説明から部分一致検索
- [ ] 検索結果は通常のリスト形式で表示

**優先度**: P1(重要)

#### 8. 優先度と期限の詳細管理

**ユーザーストーリー**:
開発者として、タスクに優先度と期限を設定し、それに基づいてソートしたい。

**受け入れ条件**:
- [ ] 優先度: `low`, `medium`, `high`, `urgent` の4段階
- [ ] `task list --sort priority` で優先度順にソート
- [ ] `task list --sort due` で期限順にソート
- [ ] 期限切れタスクは赤色で表示

**優先度**: P1(重要)

#### 9. タスク完了時の自動PR作成

**ユーザーストーリー**:
開発者として、タスク完了時に自動的にPRを作成してほしい。

**受け入れ条件**:
- [ ] `task done <id> --pr` でPRを自動作成
- [ ] PRタイトルはタスクタイトル、本文はタスク説明を使用
- [ ] GitHub CLIを使用してPR作成

**優先度**: P1(重要)

#### 10. チーム機能

**ユーザーストーリー**:
テックリードとして、チームメンバー全員のタスク状況をCLIで確認したい。

**受け入れ条件**:
- [ ] `task list --team` でチーム全員のタスク一覧を表示
- [ ] `task assign <id> @username` でタスクをアサイン
- [ ] Git経由でチーム間のタスクデータを共有

**優先度**: P2(できれば)

#### 11. 作業時間トラッキング

**ユーザーストーリー**:
開発者として、各タスクにどれくらい時間をかけたか記録したい。

**受け入れ条件**:
- [ ] `task start <id>` で作業時間の計測開始
- [ ] `task done <id>` で作業時間を記録
- [ ] `task show <id>` で累積作業時間を表示

**優先度**: P2(できれば)

#### 12. タスクテンプレート

**ユーザーストーリー**:
開発者として、よく使うタスク形式をテンプレート化したい。

**受け入れ条件**:
- [ ] `task template create <name>` でテンプレート作成
- [ ] `task add --template <name> "タイトル"` でテンプレート使用

**優先度**: P2(できれば)

### CLIインターフェース

```bash
# 初期化
task init

# タスク作成
task add "ユーザー認証機能の実装"
task add "緊急バグ修正" --priority high --due 2025-01-20

# タスク一覧
task list
task list --status in_progress
task list --priority high
task list --sort priority

# タスク詳細表示
task show 1

# タスク開始(ステータスをin_progressに変更 + Gitブランチ作成・切り替え)
task start 1

# タスク完了(ステータスをcompletedに変更)
task done 1

# タスク削除
task delete 1

# タスク検索(P1)
task search "認証"

# GitHub連携(P1)
task sync
task import --github

# PR自動作成(P1)
task done 1 --pr

# チーム機能(P2)
task list --team
task assign 1 @alice

# ヘルプ
task --help
task add --help
```

## 非機能要件

### パフォーマンス
- **コマンド実行時間**: 100ms以内(平均的なPC環境、SSD、タスク数1000件以下)
  - 測定方法: `time task list` での実測値
- **タスク一覧表示**: 1000件まで1秒以内、10000件まで5秒以内
  - 測定方法: パフォーマンステストスクリプトで大量データ投入して測定
- **起動時間**: CLIコマンド実行開始から最初の出力まで50ms以内
  - 測定方法: `time task --version` での実測値

### ユーザビリティ
- **学習時間**: 新規ユーザーが5分以内に基本操作(add, list, start, done)を習得できる
  - 測定方法: 初見ユーザー5人にタスクを与え、ヘルプのみで完了できるか測定
- **ヘルプの充実**: `task --help` および `task <command> --help` で全機能とオプションを確認できる
- **エラーメッセージの明確さ**: エラー発生時、原因と対処法を平易な言葉で提示する
  - 例: 「Error: .taskディレクトリが見つかりません。`task init`を実行してください」
- **カラー表示**: ステータスや優先度を色分けして直感的に把握できる(カラー無効化オプションも提供)

### 信頼性
- **データ損失ゼロ**: JSON書き込み前に必ずバックアップを作成し、エラー時は復旧可能にする
  - 測定方法: 書き込み中の強制終了テストで100回中100回復旧成功
- **ロールバック機能**: データ破損時、バックアップからの復旧方法を自動提示
- **危険な操作の確認**: `task delete` 実行時は確認プロンプトを表示(--forceオプションでスキップ可能)
- **Git操作の安全性**: ブランチ作成前に未コミットの変更を検出し、警告を表示

### セキュリティ
- **個人情報の保護**: GitHub Personal Access Tokenは平文で保存せず、OSのキーチェーン(macOS Keychain, Linux Secret Service)を使用
- **匿名統計のオプトイン**: 利用統計送信はデフォルトOFF、`task init`時に明示的な許可を求める
- **ローカルファイルのパーミッション**: `.task/tasks.json` は作成時にパーミッション600(所有者のみ読み書き可能)に設定

### スケーラビリティ
- **タスク数の上限**: 10000タスクまで実用的な速度で動作(list表示5秒以内)
- **マルチプロジェクト対応**: 各Gitリポジトリのルートに独立した`.task/`ディレクトリを持ち、プロジェクトごとにタスク管理可能
- **チーム規模**: 10人までのチームで快適に利用可能(P2機能)

### 互換性
- **OS対応**: macOS(10.15以降), Linux(Ubuntu 20.04以降), Windows(WSL2)
- **Node.jsバージョン**: Node.js 22.x (LTS)推奨、18.x以降で動作
- **Gitバージョン**: Git 2.30以降
- **ターミナル**: ANSI色対応ターミナル(iTerm2, Alacritty, Windows Terminal等)

## スコープ外

明示的にスコープ外とする項目:
- **Web UI**: GUIは提供しない(CLIに特化)
- **モバイルアプリ**: スマートフォン向けアプリは提供しない
- **リアルタイム同期**: WebSocketやリアルタイムDBによる即時同期は行わない(Git経由の同期のみ)
- **高度なプロジェクト管理機能**: ガントチャート、バーンダウンチャート、カンバンボードなどの可視化機能
- **時間管理機能**: ポモドーロタイマー、タイムトラッキングの詳細分析(P2の基本的な作業時間記録は含む)
- **複雑な権限管理**: ユーザーロール、タスクの閲覧・編集権限の細かい制御
- **多言語対応**: 初期バージョンは英語UIのみ(将来的な多言語化は検討)
- **カスタムフィールド**: タスクに任意のフィールドを追加する機能(将来的なプラグインシステムで対応検討)
